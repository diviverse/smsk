<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title class="notranslate">Germanist</title>
    <meta
      name="description"
      content="Professionelle Verbkonjugation und Grammatikprüfung für Deutschlernende."
    />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://deutsh.smsk.one" />
    <meta property="og:title" content="Germanist" />
    <meta
      property="og:description"
      content="Professionelle Verbkonjugation und Grammatikprüfung für Deutschlernende."
    />
    <meta property="og:locale" content="de_DE" />
    <meta property="og:site_name" content="Germanist" />

    <meta name="author" content="Germanist" />
    <meta
      name="keywords"
      content="Deutsch, Verb, Konjugation, Grammatik, Deutsch lernen, German verbs, conjugation"
    />
    <meta name="theme-color" content="#3b82f6" />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link href="style.css" rel="stylesheet" />
  </head>
  <body>
    <header class="header">
      <div class="particle-system"></div>
      <div class="container-final-final-enhanced">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <h1 class="h4 mb-0 display-font notranslate">
              <i
                class="fas fa-globe me-1"
                style="
                  background: url('favicon.ico');
                  -webkit-background-clip: text;
                  background-clip: text;
                  background-size: 100% 100%;
                  color: transparent;
                "
              ></i>
              Germanist
            </h1>
            <small class="text-white-50"
              >Professionelle Verbkonjugation und Grammatikprüfung für
              Deutschlernende</small
            >
          </div>
          <div class="d-flex gap-3 align-items-center">
            <div class="dark-mode-toggle-final-final-enhanced">
              <input
                type="checkbox"
                id="themeToggle"
                class="form-check-input"
              />
              <div class="dark-mode-slider-final-final-enhanced">
                <i class="fas fa-moon"></i>
              </div>
              <div class="toggle-icons-final-final-enhanced">
                <i class="fas fa-sun"></i>
                <i class="fas fa-moon"></i>
              </div>
            </div>
            <button
              class="btn btn-outline-light btn-custom final-final-touch"
              onclick="showHelp()"
            >
              <i class="fas fa-question-circle"></i> Hilfe
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="container-final-final-enhanced mb-5">
      <div class="tab-navigation mb-4">
        <div class="card">
          <div class="card-body p-3">
            <ul class="nav nav-tabs nav-tabs-custom" role="tablist">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link active"
                  id="conjugation-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#conjugation-pane"
                  type="button"
                  role="tab"
                  aria-controls="conjugation-pane"
                  aria-selected="true"
                  onclick="switchTab('conjugation')"
                >
                  <i class="fas fa-book"></i> Konjugation
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="grammar-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#grammar-pane"
                  type="button"
                  role="tab"
                  aria-controls="grammar-pane"
                  aria-selected="false"
                  onclick="switchTab('grammar')"
                >
                  <i class="fas fa-spell-check"></i> Grammatikprüfung
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="tab-content">
        <div
          class="tab-pane fade show active"
          id="conjugation-pane"
          role="tabpanel"
          aria-labelledby="conjugation-tab"
        >
          <div class="row">
            <div class="col-lg-4 mb-4">
              <div class="card mb-4 fade-in-up">
                <div class="card-header bg-gradient-primary text-white">
                  <strong
                    ><i class="fas fa-plus-circle"></i> Verb Hinzufügen</strong
                  >
                </div>
                <div class="card-body">
                  <ul class="nav nav-tabs nav-tabs-small mb-3" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link active"
                        id="single-verb-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#single-verb-pane"
                        type="button"
                        role="tab"
                      >
                        <i class="fas fa-plus"></i> Einzeln hinzufügen
                      </button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link"
                        id="text-paste-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#text-paste-pane"
                        type="button"
                        role="tab"
                      >
                        <i class="fas fa-paste"></i> Text einfügen
                      </button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link"
                        id="file-upload-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#file-upload-pane"
                        type="button"
                        role="tab"
                      >
                        <i class="fas fa-file"></i> Datei hochladen
                      </button>
                    </li>
                    <li class="nav-item ms-auto">
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-info p-1"
                        data-bs-toggle="modal"
                        data-bs-target="#bulkUploadHelpModal"
                        title="Hilfe"
                        style="
                          width: 24px;
                          height: 24px;
                          padding: 0;
                          display: flex;
                          align-items: center;
                          justify-content: center;
                        "
                      >
                        <i
                          class="fas fa-question-circle"
                          style="font-size: 12px"
                        ></i>
                      </button>
                    </li>
                  </ul>

                  <div class="tab-content">
                    <div
                      class="tab-pane fade show active"
                      id="single-verb-pane"
                      role="tabpanel"
                    >
                      <form id="verbForm" class="enhanced-spacing">
                        <div class="mb-3">
                          <label for="verbInput" class="form-label"
                            >Verb (Infinitiv)</label
                          >
                          <input
                            id="verbInput"
                            class="form-control optimize-legibility notranslate"
                            placeholder="z.B. gehen, machen, lernen"
                            autocapitalize="off"
                            autocorrect="off"
                            spellcheck="false"
                            inputmode="text"
                          />
                          <div class="form-text">
                            Geben Sie ein deutsches Verb im Infinitiv ein.
                          </div>
                        </div>
                        <div class="mb-3">
                          <label for="turkishMeaning" class="form-label"
                            >Türkische Bedeutung (Optional)</label
                          >
                          <input
                            id="turkishMeaning"
                            class="form-control optimize-legibility notranslate"
                            placeholder="z.B. gitmek, yapmak, öğrenmek"
                            autocapitalize="off"
                          />
                        </div>
                        <button
                          type="submit"
                          class="btn btn-primary-custom btn-custom final-final-touch w-100"
                        >
                          <i class="fas fa-plus"></i> Verb Hinzufügen
                        </button>
                      </form>
                    </div>

                    <div
                      class="tab-pane fade"
                      id="file-upload-pane"
                      role="tabpanel"
                    >
                      <div class="mb-3">
                        <label for="verbFileInput" class="form-label"
                          >Datei auswählen (TXT oder XLSX)</label
                        >
                        <input
                          type="file"
                          id="verbFileInput"
                          class="form-control"
                          accept=".txt,.xlsx"
                        />
                        <div class="form-text">
                          Unterstützte Formate: TXT, XLSX
                        </div>
                      </div>

                      <div class="mb-3">
                        <label class="form-label">Import-Optionen</label>
                        <div class="form-check mb-2">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="importMode"
                            id="importAppend"
                            value="append"
                            checked
                          />
                          <label class="form-check-label" for="importAppend">
                            Zu Liste hinzufügen
                          </label>
                        </div>
                        <div class="form-check mb-2">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="importMode"
                            id="importReplace"
                            value="replace"
                          />
                          <label class="form-check-label" for="importReplace">
                            Liste ersetzen
                          </label>
                        </div>
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="skipDuplicates"
                            checked
                          />
                          <label class="form-check-label" for="skipDuplicates">
                            Duplikate überspringen
                          </label>
                        </div>
                      </div>

                      <button
                        type="button"
                        class="btn btn-success-custom btn-custom final-final-touch w-100"
                        onclick="processBulkImport()"
                        id="bulkImportBtn"
                      >
                        <i class="fas fa-upload"></i> Verben importieren
                      </button>
                    </div>

                    <div
                      class="tab-pane fade"
                      id="text-paste-pane"
                      role="tabpanel"
                    >
                      <div class="mb-3">
                        <label for="bulkTextInput" class="form-label"
                          >Verben einfügen</label
                        >
                        <textarea
                          id="bulkTextInput"
                          class="form-control"
                          rows="5"
                          placeholder="Fügen Sie hier Ihren Text ein. Alle Wörter werden automatisch erkannt..."
                        ></textarea>
                        <div class="form-text">
                          Alle Wörter im Text werden automatisch erkannt und
                          hinzugefügt.
                        </div>
                      </div>

                      <div class="mb-3">
                        <label class="form-label">Import-Optionen</label>
                        <div class="form-check mb-2">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="importMode"
                            id="importAppend2"
                            value="append"
                            checked
                          />
                          <label class="form-check-label" for="importAppend2">
                            Zu Liste hinzufügen
                          </label>
                        </div>
                        <div class="form-check mb-2">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="importMode"
                            id="importReplace2"
                            value="replace"
                          />
                          <label class="form-check-label" for="importReplace2">
                            Liste ersetzen
                          </label>
                        </div>
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="skipDuplicates2"
                            checked
                          />
                          <label class="form-check-label" for="skipDuplicates2">
                            Duplikate überspringen
                          </label>
                        </div>
                      </div>

                      <button
                        type="button"
                        class="btn btn-success-custom btn-custom final-final-touch w-100"
                        onclick="processBulkImport()"
                        id="bulkImportBtn2"
                      >
                        <i class="fas fa-upload"></i> Verben importieren
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="card fade-in-up">
                <div class="card-header bg-secondary text-white">
                  <strong><i class="fas fa-list"></i> Verbliste</strong>
                  <span class="badge bg-light text-dark" id="verbCount">0</span>
                </div>
                <div
                  class="card-body"
                  style="max-height: 400px; overflow-y: auto"
                >
                  <div id="verbList"></div>
                  <div class="text-center mt-4">
                    <button
                      class="btn btn-outline-danger btn-sm m-1 final-final-touch"
                      onclick="clearAllVerbs()"
                    >
                      <i class="fas fa-trash"></i> Alle Löschen
                    </button>
                    <button
                      class="btn btn-primary btn-sm m-1 final-final-touch"
                      onclick="sortAllVerbs()"
                    >
                      <i class="fas fa-arrow-down-a-z"></i> Sortieren
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <section class="col-lg-8">
              <div class="card mb-4 fade-in-up">
                <div class="card-header bg-info text-white">
                  <strong
                    ><i class="fas fa-cog"></i> Konjugationsoptionen</strong
                  >
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-6">
                      <label class="mb-3">Zeiten Auswählen:</label>
                      <div class="space-y-2">
                        <label class="form-check">
                          <input
                            type="checkbox"
                            id="indikativ"
                            class="form-check-input"
                            checked
                          />
                          <span class="form-check-label notranslate"
                            >Indikativ</span
                          >
                        </label>
                        <label class="form-check">
                          <input
                            type="checkbox"
                            id="konj1"
                            class="form-check-input"
                          />
                          <span class="form-check-label notranslate"
                            >Konjunktiv I</span
                          >
                        </label>
                        <label class="form-check">
                          <input
                            type="checkbox"
                            id="konj2"
                            class="form-check-input"
                          />
                          <span class="form-check-label notranslate"
                            >Konjunktiv II</span
                          >
                        </label>
                        <label class="form-check">
                          <input
                            type="checkbox"
                            id="meaning"
                            class="form-check-input"
                            checked
                          />
                          <span class="form-check-label">Bedeutung</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <div class="row mt-4">
                    <div class="col-md-6 mb-3">
                      <button
                        class="btn btn-success-custom btn-custom final-final-touch w-100"
                        onclick="conjugateAllVerbs()"
                      >
                        <i class="fas fa-sync-alt"></i> Alle Konjugieren
                      </button>
                    </div>
                    <div class="col-md-6">
                      <div class="d-grid gap-2">
                        <button
                          class="btn btn-outline-primary btn-custom final-final-touch"
                          onclick="exportAsText()"
                        >
                          <i class="fas fa-file-alt"></i> Als Text
                        </button>
                        <button
                          class="btn btn-outline-success btn-custom final-final-touch"
                          onclick="exportAsExcel()"
                        >
                          <i class="fas fa-file-excel"></i> Als Excel
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="loading" id="loadingSpinner">
                <div
                  class="spinner-border animate-spin-slow"
                  role="status"
                ></div>
                <p class="mb-0 mt-3">Verben werden konjugiert...</p>
                <div class="progress mt-3" style="width: 200px; margin: 0 auto">
                  <div
                    class="progress-bar"
                    role="progressbar"
                    style="width: 0%"
                  ></div>
                </div>
                <small class="text-muted mt-2">0%</small>
              </div>

              <div id="conjugationCardsContainer" class="d-block"></div>
            </section>
          </div>
        </div>

        <div
          class="tab-pane fade"
          id="grammar-pane"
          role="tabpanel"
          aria-labelledby="grammar-tab"
        >
          <div class="row">
            <div class="col-12">
              <div class="card mb-4 fade-in-up">
                <div class="card-header bg-gradient-primary text-white">
                  <strong
                    ><i class="fas fa-spell-check"></i> Grammatikprüfung</strong
                  >
                </div>
                <div class="card-body">
                  <div class="mb-3">
                    <label for="grammarTextInput" class="form-label"
                      >Text eingeben</label
                    >
                    <textarea
                      id="grammarTextInput"
                      class="form-control optimize-legibility notranslate"
                      rows="10"
                      placeholder="Geben Sie hier Ihren deutschen Text ein, um Grammatikfehler zu finden..."
                    ></textarea>
                    <div class="form-text d-flex justify-content-between mt-2">
                      <span id="textStats">0 Zeichen, 0 Wörter</span>
                      <button
                        class="btn btn-sm btn-outline-secondary"
                        onclick="loadExampleText()"
                      >
                        <i class="fas fa-lightbulb"></i> Beispieltext laden
                      </button>
                    </div>
                  </div>
                  <div class="d-flex gap-2 mb-3">
                    <button
                      class="btn btn-primary-custom btn-custom final-final-touch"
                      onclick="checkGrammarText()"
                      id="checkGrammarBtn"
                    >
                      <i class="fas fa-check-circle"></i> Prüfen
                    </button>
                    <button
                      class="btn btn-outline-secondary btn-custom final-final-touch"
                      onclick="clearGrammarText()"
                    >
                      <i class="fas fa-eraser"></i> Löschen
                    </button>
                    <button
                      class="btn btn-outline-success btn-custom final-final-touch"
                      onclick="copyCorrectedText()"
                      id="copyCorrectedBtn"
                      style="display: none"
                      title="Kopiert den aktuellen Text aus dem Eingabefeld"
                    >
                      <i class="fas fa-copy"></i> Text kopieren
                    </button>
                  </div>

                  <div
                    id="grammarLoading"
                    class="loading"
                    style="display: none"
                  >
                    <div
                      class="spinner-border animate-spin-slow"
                      role="status"
                    ></div>
                    <p class="mb-0 mt-3">Text wird geprüft...</p>
                  </div>

                  <div id="grammarResults" style="display: none">
                    <div class="alert alert-info mb-3">
                      <strong id="errorCount">0 Fehler gefunden</strong>
                    </div>

                    <div class="card mb-3">
                      <div class="card-header bg-secondary text-white">
                        <strong>Text mit Markierungen</strong>
                      </div>
                      <div class="card-body">
                        <div
                          id="highlightedText"
                          class="grammar-highlighted-text notranslate"
                        ></div>
                      </div>
                    </div>

                    <div class="card">
                      <div class="card-header bg-info text-white">
                        <strong>Fehlerdetails und Vorschläge</strong>
                      </div>
                      <div class="card-body">
                        <div id="errorList"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div class="modal fade" id="bulkUploadHelpModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-question-circle"></i> Bulk Upload Hilfe
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <h6 class="text-primary mb-3">
              <i class="fas fa-file-text"></i> TXT Datei oder Text einfügen
            </h6>
            <p>
              Wenn Sie eine TXT-Datei hochladen oder Text einfügen, durchsucht
              die Website automatisch den gesamten Text nach Wörtern und fügt
              alle gefundenen Wörter zur Verbliste hinzu.
            </p>
            <p class="mb-4">
              <strong>Beispiel:</strong> Der Text "Ich gehe heute in die Schule
              und lerne Deutsch" würde die Wörter "gehe", "lerne" erkennen und
              hinzufügen.
            </p>

            <h6 class="text-primary mb-3">
              <i class="fas fa-file-excel"></i> XLSX Datei
            </h6>
            <p>
              Wenn Sie eine Excel-Datei (XLSX) hochladen, erwartet die Website
              folgendes Format:
            </p>
            <ul>
              <li><strong>Spalte A:</strong> Deutsche Verben (erforderlich)</li>
              <li>
                <strong>Spalte B:</strong> Türkische Bedeutungen (optional)
              </li>
            </ul>
            <div class="alert alert-info mt-3">
              <strong>Hinweis:</strong> Die erste Zeile kann Überschriften
              enthalten und wird automatisch übersprungen.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="helpModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-question-circle"></i> Bedienungsanleitung
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <ol class="enhanced-spacing">
              <li>
                <strong>Verb Hinzufügen:</strong> Geben Sie ein deutsches Verb
                im Infinitiv ein.
              </li>
              <li>
                <strong>Türkische Bedeutung:</strong> Optional hinzufügen.
              </li>
              <li>
                <strong>Zeiten Auswählen:</strong> Gewünschte Zeitformen wählen.
              </li>
              <li>
                <strong>Konjugieren:</strong> Klicken Sie auf "Alle konjugieren"
                oder drücken Sie STRG+Eingabe.
              </li>
              <li><strong>Export:</strong> Als Text oder Excel exportieren.</li>
            </ol>
            <hr class="my-4" />
            <h6 class="text-gradient">Unterstützte Zeitformen:</h6>
            <ul class="list-unstyled notranslate">
              <li>
                <i class="fas fa-check-circle text-primary me-2"></i
                ><strong>Präsens</strong>
              </li>
              <li>
                <i class="fas fa-check-circle text-primary me-2"></i
                ><strong>Perfekt</strong>
              </li>
              <li>
                <i class="fas fa-check-circle text-primary me-2"></i
                ><strong>Präteritum</strong>
              </li>
              <li>
                <i class="fas fa-check-circle text-primary me-2"></i
                ><strong>Plusquamperfekt</strong>
              </li>
              <li>
                <i class="fas fa-check-circle text-primary me-2"></i
                ><strong>Futur I</strong>
              </li>
              <li>
                <i class="fas fa-check-circle text-primary me-2"></i
                ><strong>Futur II</strong>
              </li>
              <li>
                <i class="fas fa-check-circle text-primary me-2"></i
                ><strong>Konjunktiv I</strong>
              </li>
              <li>
                <i class="fas fa-check-circle text-primary me-2"></i
                ><strong>Konjunktiv II</strong>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <div class="gtranslate_wrapper"></div>
    <script>
      window.gtranslateSettings = {
        default_language: "de",
        native_language_names: true,
        languages: ["de", "tr", "en"],
        wrapper_selector: ".gtranslate_wrapper",
        switcher_horizontal_position: "right",
        alt_flags: { en: "usa" },
      };
    </script>
    <script
      src="https://cdn.gtranslate.net/widgets/latest/float.js"
      defer
    ></script>

    <script>
      let verbList = [];
      let conjugationData = {};
      let exportInProgress = false;

      const PRONOUNS = ["ich", "du", "er/sie/es", "wir", "ihr", "sie/Sie"];
      const CONJUGATION_META = {
        PRASENS: { label: "Präsens", mood: "Indikativ" },
        PRATERITUM: { label: "Präteritum", mood: "Indikativ" },
        PERFEKT: { label: "Perfekt", mood: "Indikativ" },
        PLUSQUAMPERFEKT: { label: "Plusquamperfekt", mood: "Indikativ" },
        FUTUR1: { label: "Futur I", mood: "Indikativ" },
        FUTUR2: { label: "Futur II", mood: "Indikativ" },
        KONJUNKTIV1_PRASENS: { label: "Präsens", mood: "Konjunktiv I" },
        KONJUNKTIV1_FUTUR1: { label: "Futur I", mood: "Konjunktiv I" },
        KONJUNKTIV1_PERFEKT: { label: "Perfekt", mood: "Konjunktiv I" },
        KONJUNKTIV2_PRATERITUM: { label: "Präteritum", mood: "Konjunktiv II" },
        KONJUNKTIV2_FUTUR1: { label: "Futur I", mood: "Konjunktiv II" },
        KONJUNKTIV2_FUTUR2: { label: "Futur II", mood: "Konjunktiv II" },
      };

      document.addEventListener("DOMContentLoaded", function () {
        initializeParticles();
        initializeTheme();
        clearExpiredCache();
        loadFromLocalStorage();
        updateVerbList();
        addKeyboardShortcuts();
        restoreActiveTab();
      });

      function initializeParticles() {
        const particleContainer = document.querySelector(".particle-system");
        if (!particleContainer) return;

        for (let i = 0; i < 50; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 25 + "s";
          particle.style.animationDuration = Math.random() * 10 + 15 + "s";
          particleContainer.appendChild(particle);
        }
      }

      function initializeTheme() {
        const themeToggle = document.getElementById("themeToggle");
        if (!themeToggle) return;

        const toggleContainer = themeToggle.closest(
          ".dark-mode-toggle-final-final-enhanced"
        );
        if (!toggleContainer) return;

        const stored = localStorage.getItem("theme");
        const prefersDark =
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;
        const dark = stored ? stored === "dark" : prefersDark;

        applyTheme(dark ? "dark" : "light");
        themeToggle.checked = dark;
        updateToggleVisuals(themeToggle, toggleContainer);

        themeToggle.addEventListener("change", function () {
          const mode = this.checked ? "dark" : "light";
          applyTheme(mode);
          localStorage.setItem("theme", mode);
          updateToggleVisuals(this, toggleContainer);
        });

        window
          .matchMedia("(prefers-color-scheme: dark)")
          .addEventListener("change", (e) => {
            if (!localStorage.getItem("theme")) {
              applyTheme(e.matches ? "dark" : "light");
              themeToggle.checked = e.matches;
              updateToggleVisuals(themeToggle, toggleContainer);
            }
          });
      }

      function updateToggleVisuals(toggle, container) {
        if (!container) return;
        if (toggle.checked) {
          container.classList.add("toggle-checked");
        } else {
          container.classList.remove("toggle-checked");
        }
      }

      function applyTheme(name) {
        if (name === "dark") {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      }

      function showAlert(msg, type = "info") {
        const alertDiv = document.createElement("div");
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 12px; padding-right: 8px;">
            <span style="flex: 1;">${msg}</span>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close" style="opacity: 1; flex-shrink: 0;"></button>
          </div>
        `;

        const colors = {
          info: "#3b82f6",
          success: "#10b981",
          warning: "#f59e0b",
          danger: "#ef4444",
        };

        alertDiv.style.cssText = `
          position: fixed;
          top: 20px;
          left: 50%;
          z-index: 2000;
          background: linear-gradient(135deg, ${colors[type]} 0%, ${colors[type]}dd 100%);
          color: white;
          border: none;
          border-radius: 12px;
          padding: 16px 24px;
          font-weight: 500;
          box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
          min-width: 300px;
          max-width: 90vw;
          transform: translateX(-50%);
          animation: slideInDownCentered 0.3s ease-out;
        `;

        document.body.appendChild(alertDiv);

        setTimeout(() => {
          alertDiv.remove();
        }, 5000);
      }

      function showLoading(show) {
        const loading = document.getElementById("loadingSpinner");
        if (!loading) return;

        loading.style.display = show ? "block" : "none";

        if (show) {
          const progressBar = loading.querySelector(".progress-bar");
          const progressText = loading.querySelector("small");
          if (progressBar) progressBar.style.width = "0%";
          if (progressText) progressText.textContent = "0%";
        }
      }

      function updateProgress(current, total) {
        const loading = document.getElementById("loadingSpinner");
        if (!loading) return;

        const progressBar = loading.querySelector(".progress-bar");
        const progressText = loading.querySelector("small");

        if (progressBar && progressText) {
          const progress = Math.round((current / total) * 100);
          progressBar.style.width = progress + "%";
          progressBar.textContent = progress + "%";
          progressText.textContent = `${current} von ${total} Verben konjugiert`;
        }
      }

      function saveToLocalStorage() {
        localStorage.setItem("verbList", JSON.stringify(verbList));
      }

      function loadFromLocalStorage() {
        const saved = localStorage.getItem("verbList");
        if (saved) {
          verbList = JSON.parse(saved);
        }
      }

      function saveToCache(key, data) {
        const cacheData = {
          data: data,
          timestamp: Date.now(),
          expires: Date.now() + 24 * 60 * 60 * 1000,
        };
        localStorage.setItem(key, JSON.stringify(cacheData));
      }

      function getFromCache(key) {
        const cached = localStorage.getItem(key);
        if (!cached) return null;

        try {
          const parsed = JSON.parse(cached);
          if (parsed.expires && parsed.expires < Date.now()) {
            localStorage.removeItem(key);
            return null;
          }
          return parsed.data;
        } catch (e) {
          return null;
        }
      }

      function clearExpiredCache() {
        const keys = Object.keys(localStorage);
        const now = Date.now();
        let cleared = 0;

        keys.forEach((key) => {
          if (key.startsWith("conj_")) {
            try {
              const cached = localStorage.getItem(key);
              if (cached) {
                const parsed = JSON.parse(cached);
                if (parsed.expires && parsed.expires < now) {
                  localStorage.removeItem(key);
                  cleared++;
                }
              }
            } catch (e) {
              localStorage.removeItem(key);
              cleared++;
            }
          }
        });

        if (cleared > 0) {
          console.log(`Cleared ${cleared} expired cache entries`);
        }
      }

      const verbFormEl = document.getElementById("verbForm");
      if (verbFormEl) {
        verbFormEl.addEventListener("submit", function (e) {
          e.preventDefault();
          addVerb();
        });
      }

      function addVerb() {
        const verbInput = document.getElementById("verbInput");
        const turkishInput = document.getElementById("turkishMeaning");

        const verb = verbInput?.value.trim().toLowerCase() || "";
        const turkish = turkishInput?.value.trim() || "";

        if (!verb) {
          showAlert("Bitte geben Sie ein Verb ein!", "warning");
          return;
        }

        if (verbList.some((v) => v.verb === verb)) {
          showAlert("Dieses Verb existiert bereits!", "warning");
          return;
        }

        verbList.push({
          verb: verb,
          turkish: turkish,
          id: Date.now(),
        });

        verbInput.value = "";
        turkishInput.value = "";

        updateVerbList();
        saveToLocalStorage();
        showAlert("Verb erfolgreich hinzugefügt!", "success");
      }

      function updateVerbList() {
        const container = document.getElementById("verbList");
        const count = document.getElementById("verbCount");

        count.textContent = verbList.length;

        if (verbList.length === 0) {
          container.innerHTML =
            '<p class="text-muted text-center">Keine Verben vorhanden</p>';
          return;
        }

        container.innerHTML = verbList
          .map(
            (item) => `
          <div class="verb-item final-final-touch" data-verb="${escapeHtml(
            item.verb
          )}">
            <div>
              <strong class="notranslate">${escapeHtml(item.verb)}</strong>
              ${
                item.turkish
                  ? `<small class="text-muted notranslate">(${escapeHtml(
                      item.turkish
                    )})</small>`
                  : ""
              }
            </div>
            <div>
              <span class="me-2">
                <button class="btn btn-sm btn-outline-secondary move-up final-final-touch" onclick="moveUpVerb('${escapeHtml(
                  item.verb
                )}')">
                  <i class="fas fa-chevron-up"></i>
                </button>
                <button class="btn btn-sm btn-outline-secondary move-down final-final-touch" onclick="moveDownVerb('${escapeHtml(
                  item.verb
                )}')">
                  <i class="fas fa-chevron-down"></i>
                </button>
              </span>
              <button class="btn btn-sm btn-outline-danger final-final-touch" onclick="removeVerb(${
                item.id
              })">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        `
          )
          .join("");
      }

      function moveUpVerb(verb) {
        const index = verbList.findIndex((v) => v.verb === verb);
        if (index > 0) {
          [verbList[index - 1], verbList[index]] = [
            verbList[index],
            verbList[index - 1],
          ];
          updateVerbList();
          saveToLocalStorage();
        }
      }

      function moveDownVerb(verb) {
        const index = verbList.findIndex((v) => v.verb === verb);
        if (index === -1 || index >= verbList.length - 1) return;
        [verbList[index], verbList[index + 1]] = [
          verbList[index + 1],
          verbList[index],
        ];
        updateVerbList();
        saveToLocalStorage();
      }

      function removeVerb(id) {
        verbList = verbList.filter((v) => v.id !== id);
        updateVerbList();
        saveToLocalStorage();
        showAlert("Verb entfernt!", "info");
      }

      function clearAllVerbs() {
        if (!confirm("Möchten Sie wirklich alle Verben löschen?")) return;
        verbList = [];
        conjugationData = {};
        updateVerbList();
        document.getElementById("conjugationCardsContainer").innerHTML = "";
        saveToLocalStorage();
        showAlert("Alle Verben wurden gelöscht!", "info");
      }

      function sortAllVerbs() {
        verbList.sort((a, b) => a.verb.localeCompare(b.verb));
        updateVerbList();
        saveToLocalStorage();
        showAlert("Verben alphabetisch sortiert!", "success");
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      function parseTextForVerbs(text) {
        const wordRegex = /\b[a-zäöüß]+\b/gi;
        const matches = text.match(wordRegex) || [];

        const uniqueWords = [...new Set(matches.map((w) => w.toLowerCase()))];

        const commonWords = [
          "der",
          "die",
          "das",
          "ein",
          "eine",
          "und",
          "oder",
          "aber",
          "ist",
          "sind",
          "war",
          "waren",
        ];
        const verbs = uniqueWords.filter(
          (word) => word.length > 2 && !commonWords.includes(word)
        );

        return verbs.map((verb) => ({ verb, turkish: "" }));
      }

      async function parseUploadedFile(file) {
        return new Promise((resolve, reject) => {
          const fileName = file.name.toLowerCase();
          const fileExtension = fileName.split(".").pop();

          if (fileExtension === "txt") {
            const reader = new FileReader();
            reader.onload = function (e) {
              try {
                const text = e.target.result;
                const verbs = parseTextForVerbs(text);
                resolve(verbs);
              } catch (error) {
                reject(
                  new Error("Fehler beim Lesen der TXT-Datei: " + error.message)
                );
              }
            };
            reader.onerror = () =>
              reject(new Error("Fehler beim Lesen der Datei"));
            reader.readAsText(file, "UTF-8");
          } else if (fileExtension === "xlsx") {
            const reader = new FileReader();
            reader.onload = function (e) {
              try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: "array" });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, {
                  header: 1,
                  defval: "",
                });

                const verbs = [];

                const startRow =
                  jsonData.length > 0 &&
                  typeof jsonData[0][0] === "string" &&
                  (jsonData[0][0].toLowerCase().includes("verb") ||
                    jsonData[0][0].toLowerCase().includes("wort"))
                    ? 1
                    : 0;

                for (let i = startRow; i < jsonData.length; i++) {
                  const row = jsonData[i];
                  const verb = String(row[0] || "")
                    .trim()
                    .toLowerCase();
                  const turkish = String(row[1] || "").trim();

                  if (verb && /^[a-zäöüß]+$/.test(verb)) {
                    verbs.push({ verb, turkish });
                  }
                }

                resolve(verbs);
              } catch (error) {
                reject(
                  new Error(
                    "Fehler beim Lesen der Excel-Datei: " + error.message
                  )
                );
              }
            };
            reader.onerror = () =>
              reject(new Error("Fehler beim Lesen der Datei"));
            reader.readAsArrayBuffer(file);
          } else {
            reject(
              new Error(
                "Nicht unterstütztes Dateiformat. Bitte verwenden Sie TXT oder XLSX."
              )
            );
          }
        });
      }

      async function processBulkImport() {
        const fileInput = document.getElementById("verbFileInput");
        const textInput = document.getElementById("bulkTextInput");
        const fileTab = document.getElementById("file-upload-tab");
        const textTab = document.getElementById("text-paste-tab");
        const isFileMode = fileTab.classList.contains("active");
        const isTextMode = textTab.classList.contains("active");

        const importBtn = isFileMode
          ? document.getElementById("bulkImportBtn")
          : document.getElementById("bulkImportBtn2");

        let verbs = [];

        try {
          importBtn.disabled = true;
          importBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Wird verarbeitet...';

          if (isFileMode) {
            const file = fileInput.files[0];
            if (!file) {
              showAlert("Bitte wählen Sie eine Datei aus!", "warning");
              importBtn.disabled = false;
              importBtn.innerHTML =
                '<i class="fas fa-upload"></i> Verben importieren';
              return;
            }
            verbs = await parseUploadedFile(file);
          } else if (isTextMode) {
            const text = textInput.value.trim();
            if (!text) {
              showAlert("Bitte fügen Sie Text ein!", "warning");
              importBtn.disabled = false;
              importBtn.innerHTML =
                '<i class="fas fa-upload"></i> Verben importieren';
              return;
            }
            verbs = parseTextForVerbs(text);
          } else {
            showAlert("Bitte wählen Sie eine Import-Methode aus!", "warning");
            importBtn.disabled = false;
            importBtn.innerHTML =
              '<i class="fas fa-upload"></i> Verben importieren';
            return;
          }

          if (verbs.length === 0) {
            showAlert("Keine Verben gefunden!", "warning");
            importBtn.disabled = false;
            importBtn.innerHTML =
              '<i class="fas fa-upload"></i> Verben importieren';
            return;
          }

          const importModeRadio = document.querySelector(
            'input[name="importMode"]:checked'
          );
          const skipDuplicatesCheck =
            document.getElementById("skipDuplicates") ||
            document.getElementById("skipDuplicates2");

          const importMode = importModeRadio ? importModeRadio.value : "append";
          const skipDuplicates = skipDuplicatesCheck
            ? skipDuplicatesCheck.checked
            : true;

          importVerbs(verbs, importMode, skipDuplicates);

          fileInput.value = "";
          textInput.value = "";
        } catch (error) {
          console.error("Import error:", error);
          showAlert("Fehler beim Importieren: " + error.message, "danger");
        } finally {
          importBtn.disabled = false;
          importBtn.innerHTML =
            '<i class="fas fa-upload"></i> Verben importieren';
        }
      }

      function importVerbs(verbs, mode, skipDuplicates) {
        let added = 0;
        let skipped = 0;
        let invalid = 0;

        if (mode === "replace") {
          verbList = [];
        }

        verbs.forEach((item) => {
          const verb = item.verb.trim().toLowerCase();

          if (!verb || !/^[a-zäöüß]+$/.test(verb)) {
            invalid++;
            return;
          }

          if (skipDuplicates && verbList.some((v) => v.verb === verb)) {
            skipped++;
            return;
          }

          verbList.push({
            verb: verb,
            turkish: item.turkish || "",
            id: Date.now() + Math.random(),
          });
          added++;
        });

        updateVerbList();
        saveToLocalStorage();

        let message = `${added} Verb${
          added !== 1 ? "en" : ""
        } erfolgreich importiert!`;
        if (skipped > 0) {
          message += ` ${skipped} Duplikat${
            skipped !== 1 ? "e" : ""
          } übersprungen.`;
        }
        if (invalid > 0) {
          message += ` ${invalid} ungültige Einträge übersprungen.`;
        }
        showAlert(message, "success");
      }

      function getSelectedVerbs() {
        return verbList.map((v) => v.verb).filter(Boolean);
      }

      function getSelectedMoods() {
        const moods = [];
        if (document.getElementById("indikativ").checked)
          moods.push("INDIKATIV");
        if (document.getElementById("konj1").checked) moods.push("KONJUNKTIV1");
        if (document.getElementById("konj2").checked) moods.push("KONJUNKTIV2");
        return moods;
      }

      function stringifyParts(parts) {
        if (Array.isArray(parts)) return parts.join(" ");
        if (typeof parts === "string") return parts;
        return parts ? String(parts) : "";
      }

      function extractSixForms(tenseObj) {
        if (!tenseObj) return ["", "", "", "", "", ""];
        if (Array.isArray(tenseObj))
          return Array.from({ length: 6 }, (_, i) =>
            stringifyParts(tenseObj[i] ?? "")
          );
        const keys = ["S1", "S2", "S3", "P1", "P2", "P3"];
        if (typeof tenseObj === "object")
          return keys.map((k) => stringifyParts(tenseObj[k] ?? ""));
        if (typeof tenseObj === "string") return [tenseObj, "", "", "", "", ""];
        return ["", "", "", "", "", ""];
      }

      async function fetchVerbFromApi(verb) {
        const key = `conj_${verb}`;
        try {
          const cached = getFromCache(key);
          if (cached) return cached;

          console.log(`Fetching verb: ${verb}`);

          const resp = await fetch(
            `https://german-verbs-api.onrender.com/german-verbs-api?verb=${encodeURIComponent(
              verb
            )}`
          );

          if (!resp.ok) throw new Error("HTTP " + resp.status);
          const data = await resp.json();

          console.log(`API Response for ${verb}:`, data);
          saveToCache(key, data);
          return data;
        } catch (e) {
          console.error("fetch error", verb, e);
          throw e;
        }
      }

      function normaliseConjugations(apiData) {
        if (!apiData || typeof apiData !== "object") return {};

        console.log("Normalizing conjugations:", apiData);
        const rawData = apiData.data || apiData;

        const MAP = {
          prasens: "PRASENS",
          prateritum: "PRATERITUM",
          perfekt: "PERFEKT",
          plusquamperfekt: "PLUSQUAMPERFEKT",
          futur1: "FUTUR1",
          futur2: "FUTUR2",
          konjunktiv1_prasens: "KONJUNKTIV1_PRASENS",
          konjunktiv1_perfekt: "KONJUNKTIV1_PERFEKT",
          konjunktiv1_futur1: "KONJUNKTIV1_FUTUR1",
          konjunktiv2_prateritum: "KONJUNKTIV2_PRATERITUM",
          konjunktiv2_futur1: "KONJUNKTIV2_FUTUR1",
          konjunktiv2_futur2: "KONJUNKTIV2_FUTUR2",
        };

        const out = {};
        Object.entries(rawData).forEach(([key, value]) => {
          const normalizedKey = MAP[key.toLowerCase()];
          if (normalizedKey && value) {
            out[normalizedKey] = value;
            console.log(`Mapped ${key} -> ${normalizedKey}:`, value);
          }
        });

        console.log("Final normalized conjugations:", out);
        return out;
      }

      async function processVerb(verb) {
        try {
          const apiResult = await fetchVerbFromApi(verb);
          const verbMap = getVerbMap();

          console.log(`Processing verb ${verb}:`, apiResult);

          conjugationData[verb] = {
            verb,
            turkish: verbMap[verb] || "",
            conjugations: normaliseConjugations(apiResult),
          };

          console.log(
            `Final conjugationData for ${verb}:`,
            conjugationData[verb]
          );
        } catch (error) {
          console.error(`Error processing verb ${verb}:`, error);
          conjugationData[verb] = {
            verb,
            turkish: "",
            conjugations: {},
          };
        }
      }

      function getVerbMap() {
        return Object.fromEntries(verbList.map((v) => [v.verb, v.turkish]));
      }

      async function conjugateAllVerbs() {
        const verbs = getSelectedVerbs();
        if (verbs.length === 0) {
          showAlert("Bitte fügen Sie zuerst Verben hinzu!", "warning");
          return;
        }

        const selectedMoods = getSelectedMoods();
        if (selectedMoods.length === 0) {
          showAlert(
            "Bitte wählen Sie mindestens eine Zeitform aus!",
            "warning"
          );
          return;
        }

        showLoading(true);
        document.getElementById("conjugationCardsContainer").innerHTML = "";
        conjugationData = {};

        try {
          updateProgress(0, verbs.length);

          const CONCURRENCY_LIMIT = 3;
          let processed = 0;

          for (let i = 0; i < verbs.length; i += CONCURRENCY_LIMIT) {
            const chunk = verbs.slice(i, i + CONCURRENCY_LIMIT);
            const promises = chunk.map(async (verb) => {
              try {
                await processVerb(verb);
                processed++;
                updateProgress(processed, verbs.length);
              } catch (error) {
                processed++;
                updateProgress(processed, verbs.length);
                console.error(`Fehler bei Verb ${verb}:`, error);
              }
            });

            await Promise.all(promises);
          }

          const container = document.getElementById(
            "conjugationCardsContainer"
          );
          const fragment = document.createDocumentFragment();

          verbs.forEach((verb) => {
            if (conjugationData[verb] && conjugationData[verb].conjugations) {
              const gridCard = createVerbCard(verb, selectedMoods);
              fragment.appendChild(gridCard);
            }
          });

          container.appendChild(fragment);
          showAlert("Konjugation abgeschlossen", "success");
        } catch (error) {
          console.error("Konjugationsfehler:", error);
          showAlert("Fehler bei der Konjugation", "danger");
        } finally {
          showLoading(false);
        }
      }

      async function conjugateAllVerbsIfNot() {
        const container = document.getElementById("conjugationCardsContainer");
        if (!container.innerHTML.trim()) {
          await conjugateAllVerbs();
        }
      }

      function createVerbCard(verb, selectedMoods) {
        const showTurkish = document.getElementById("meaning").checked;
        const vData = conjugationData[verb];

        const card = document.createElement("div");
        card.className = "card mobile-card mb-3 fade-in-up";

        const header = document.createElement("div");
        header.className =
          "card-header verb-header-compact bg-gradient-primary text-white";
        header.innerHTML = `
        <div class="verb-name-compact notranslate">${escapeHtml(verb)}</div>
        ${
          showTurkish && vData.turkish
            ? `<div class="verb-turkish-compact notranslate">(${escapeHtml(
                vData.turkish
              )})</div>`
            : ""
        }
        <div class="btn-group-compact">
            <button class="btn btn-outline-light btn-sm" onclick="copyConjugations('${verb}')" title="Kopieren">
                <i class="fas fa-copy"></i>
            </button>
            <button class="btn btn-outline-light btn-sm" onclick="speakVerb('${verb}')" title="Vorlesen">
                <i class="fas fa-volume-up"></i>
            </button>
        </div>
    `;
        card.appendChild(header);

        const body = document.createElement("div");
        body.className = "card-body p-2";

        if (
          !vData.conjugations ||
          Object.keys(vData.conjugations).length === 0
        ) {
          const noData = document.createElement("div");
          noData.className = "text-center py-2";
          noData.innerHTML = `<small class="text-muted">Keine Daten</small>`;
          body.appendChild(noData);
        } else {
          const grid = renderConjugationGrid(verb, selectedMoods);
          body.appendChild(grid);
        }

        card.appendChild(body);
        return card;
      }

      function renderConjugationGrid(verb, selectedMoods) {
        const vData = conjugationData[verb];
        if (!vData || !vData.conjugations) return document.createElement("div");

        const container = document.createElement("div");
        container.className = "conjugation-grid-compact";

        const moodGroups = {};
        selectedMoods.forEach((mood) => {
          moodGroups[mood] = [];
        });

        Object.entries(vData.conjugations).forEach(([tenseKey, forms]) => {
          const meta = CONJUGATION_META[tenseKey];
          if (!meta) return;

          let moodCategory;
          if (meta.mood === "Indikativ") moodCategory = "INDIKATIV";
          else if (meta.mood === "Konjunktiv I") moodCategory = "KONJUNKTIV1";
          else if (meta.mood === "Konjunktiv II") moodCategory = "KONJUNKTIV2";

          if (moodGroups[moodCategory]) {
            moodGroups[moodCategory].push({
              tenseKey,
              label: meta.label,
              forms,
            });
          }
        });

        selectedMoods.forEach((mood, mi) => {
          const moodSection = document.createElement("div");
          moodSection.className = "mood-section-compact mb-3";

          const moodTitle = document.createElement("div");
          moodTitle.className =
            "mood-title-compact text-primary mb-2 notranslate";
          moodTitle.textContent = mood
            .replace("KONJUNKTIV", "Konjunktiv ")
            .replace("INDIKATIV", "Indikativ");
          moodSection.appendChild(moodTitle);

          const tenses = moodGroups[mood] || [];
          if (tenses.length === 0) {
            const noData = document.createElement("div");
            noData.className = "text-muted small";
            noData.textContent = "Keine Daten";
            moodSection.appendChild(noData);
            return;
          }

          const tensesContainer = document.createElement("div");
          tensesContainer.className = "tenses-grid-wrapper";

          tenses.forEach((tense) => {
            const tenseBlock = document.createElement("div");
            tenseBlock.className = "tense-block-compact";

            const tenseLabel = document.createElement("div");
            tenseLabel.className = "tense-label-compact notranslate";
            tenseLabel.textContent = tense.label;
            tenseBlock.appendChild(tenseLabel);

            const conjTable = createUltraCompactTable(tense.forms);
            tenseBlock.appendChild(conjTable);

            tensesContainer.appendChild(tenseBlock);
          });

          moodSection.appendChild(tensesContainer);

          container.appendChild(moodSection);
        });

        return container;
      }

      function createUltraCompactTable(tenseObj) {
        const table = document.createElement("table");
        table.className = "conjugation-table-ultra-compact";

        const forms = extractSixForms(tenseObj);

        const tbody = document.createElement("tbody");

        const row1 = document.createElement("tr");
        for (let i = 0; i < 3; i++) {
          const cell = document.createElement("td");
          cell.className = "conj-cell-compact";
          cell.innerHTML = `
            <div class="pronoun-ultra notranslate">${PRONOUNS[i]}</div>
            <div class="form-ultra notranslate">${forms[i] || "-"}</div>
        `;
          row1.appendChild(cell);
        }
        tbody.appendChild(row1);

        const row2 = document.createElement("tr");
        for (let i = 3; i < 6; i++) {
          const cell = document.createElement("td");
          cell.className = "conj-cell-compact";
          cell.innerHTML = `
            <div class="pronoun-ultra notranslate">${PRONOUNS[i]}</div>
            <div class="form-ultra notranslate">${forms[i] || "-"}</div>
        `;
          row2.appendChild(cell);
        }
        tbody.appendChild(row2);

        table.appendChild(tbody);
        return table;
      }

      async function exportAsText() {
        if (exportInProgress) return;
        exportInProgress = true;

        try {
          await conjugateAllVerbsIfNot();
          if (!Object.keys(conjugationData).length) {
            showAlert("Keine Konjugationsdaten vorhanden!", "warning");
            return;
          }

          let txt = "DEUTSCHE VERB KONJUGATIONEN\n";
          txt += "=".repeat(50) + "\n\n";

          Object.keys(conjugationData).forEach((v, index) => {
            const d = conjugationData[v];

            txt += `📚 ${v.toUpperCase()}`;
            if (d.turkish) txt += ` (${d.turkish})`;
            txt += "\n";
            txt += "─".repeat(40) + "\n\n";

            const moods = {};
            Object.keys(d.conjugations).forEach((t) => {
              const meta = CONJUGATION_META[t];
              if (!meta) return;

              const mood = meta.mood;
              if (!moods[mood]) moods[mood] = [];
              moods[mood].push({
                tense: t,
                label: meta.label,
                forms: d.conjugations[t],
              });
            });

            Object.entries(moods).forEach(([mood, tenses]) => {
              txt += `📝 ${mood}:\n`;
              tenses.forEach((tense) => {
                txt += `  ${tense.label}:\n`;
                const forms = extractSixForms(tense.forms);
                forms.forEach((form, i) => {
                  txt += `    ${PRONOUNS[i]}: ${form}\n`;
                });
                txt += "\n";
              });
            });

            txt += "\n" + "◆".repeat(20) + "\n\n";
          });

          downloadFile(txt, "verb_konjugationen.txt", "text/plain");
          showAlert("✅ Text-Export erfolgreich!", "success");
        } finally {
          exportInProgress = false;
        }
      }

      async function exportAsExcel() {
        await conjugateAllVerbsIfNot();
        if (!Object.keys(conjugationData).length) {
          showAlert("Keine Konjugationsdaten vorhanden!", "warning");
          return;
        }

        const verbs = Object.keys(conjugationData);
        const selectedTenses = Object.keys(
          conjugationData[verbs[0]].conjugations
        );

        const wb = XLSX.utils.book_new();

        const moodSheets = {};
        selectedTenses.forEach((t) => {
          const meta = CONJUGATION_META[t];
          if (!meta) return;

          const mood = meta.mood;
          if (!moodSheets[mood]) moodSheets[mood] = [];
          moodSheets[mood].push(t);
        });

        Object.entries(moodSheets).forEach(([mood, tenses]) => {
          const wsData = [];

          const header = [
            "Pronomen",
            ...verbs.map(
              (v) =>
                v +
                (conjugationData[v].turkish
                  ? ` (${conjugationData[v].turkish})`
                  : "")
            ),
          ];
          wsData.push(header);

          tenses.forEach((t) => {
            const tenseLabel = CONJUGATION_META[t].label;
            wsData.push([tenseLabel]);

            PRONOUNS.forEach((p, pi) => {
              const row = [p];
              verbs.forEach((v) => {
                const forms = extractSixForms(
                  conjugationData[v].conjugations[t]
                );
                row.push(forms[pi] || "");
              });
              wsData.push(row);
            });

            wsData.push([]);
          });

          const ws = XLSX.utils.aoa_to_sheet(wsData);

          const colWidths = wsData[0].map((_, ci) => {
            let max = 10;
            wsData.forEach((r) => {
              const v = r[ci] || "";
              if (v.length > max) max = v.length;
            });
            return { wch: Math.min(max + 4, 50) };
          });

          ws["!cols"] = colWidths;

          const range = XLSX.utils.decode_range(ws["!ref"]);
          for (let R = range.s.r; R <= range.e.r; ++R) {
            for (let C = range.s.c; C <= range.e.c; ++C) {
              const cell = ws[XLSX.utils.encode_cell({ r: R, c: C })];
              if (!cell) continue;

              if (R === 0) {
                cell.s = {
                  font: { bold: true, color: { rgb: "FFFFFF" } },
                  fill: { fgColor: { rgb: "3B82F6" } },
                  alignment: { horizontal: "center", vertical: "center" },
                };
              }

              if (C === 0 && R > 0 && !PRONOUNS.includes(cell.v)) {
                cell.s = {
                  font: { bold: true, color: { rgb: "1E40AF" } },
                  fill: { fgColor: { rgb: "E0E7FF" } },
                  alignment: { horizontal: "center", vertical: "center" },
                };
              }
            }
          }

          XLSX.utils.book_append_sheet(wb, ws, mood);
        });

        XLSX.writeFile(wb, "verb_konjugationen_enhanced.xlsx");
        showAlert("✅ Excel-Export erfolgreich!", "success");
      }

      function copyConjugations(verb) {
        const vData = conjugationData[verb];
        if (!vData) return;

        let text = `${verb.toUpperCase()}\n`;
        if (vData.turkish) text += `(${vData.turkish})\n\n`;

        Object.entries(vData.conjugations).forEach(([tense, forms]) => {
          const meta = CONJUGATION_META[tense];
          text += `${meta.label}:\n`;
          const conjugatedForms = extractSixForms(forms);
          conjugatedForms.forEach((form, i) => {
            text += `${PRONOUNS[i]}: ${form}\n`;
          });
          text += "\n";
        });

        navigator.clipboard
          .writeText(text)
          .then(() => {
            showAlert("Konjugationen kopiert!", "success");
          })
          .catch(() => {
            showAlert("Kopieren fehlgeschlagen", "warning");
          });
      }

      function speakVerb(verb) {
        if ("speechSynthesis" in window) {
          const utterance = new SpeechSynthesisUtterance(verb);
          utterance.lang = "de-DE";
          utterance.rate = 0.8;
          speechSynthesis.speak(utterance);
        } else {
          showAlert("Sprachsynthese nicht verfügbar", "info");
        }
      }

      function addKeyboardShortcuts() {
        document.addEventListener("keydown", function (e) {
          if (e.ctrlKey && e.key === "Enter") {
            e.preventDefault();
            conjugateAllVerbs();
          }

          if (e.key === "Escape") {
            const openModal = document.querySelector(".modal.show");
            if (openModal) {
              const modal = bootstrap.Modal.getInstance(openModal);
              if (modal) modal.hide();
            }
          }

          if (e.altKey && e.key === "n") {
            e.preventDefault();
            document.getElementById("verbInput").focus();
          }

          if (e.altKey && e.key === "c") {
            e.preventDefault();
            clearAllVerbs();
          }
        });
      }

      function showHelp() {
        const helpModal = new bootstrap.Modal(
          document.getElementById("helpModal")
        );
        helpModal.show();
      }

      let grammarErrors = [];
      let originalText = "";
      let lastGrammarCheckTime = 0;
      const GRAMMAR_CHECK_THROTTLE_MS = 10000;

      function switchTab(tabName) {
        const conjugationTab = document.getElementById("conjugation-tab");
        const grammarTab = document.getElementById("grammar-tab");

        if (tabName === "grammar") {
          const grammarTabInstance = new bootstrap.Tab(grammarTab);
          grammarTabInstance.show();
          localStorage.setItem("activeTab", "grammar");
        } else {
          const conjugationTabInstance = new bootstrap.Tab(conjugationTab);
          conjugationTabInstance.show();
          localStorage.setItem("activeTab", "conjugation");
        }
      }

      function restoreActiveTab() {
        const savedTab = localStorage.getItem("activeTab");
        if (savedTab === "grammar" || savedTab === "conjugation") {
          setTimeout(() => {
            switchTab(savedTab);
          }, 100);
        }
      }

      function updateTextStats() {
        const textarea = document.getElementById("grammarTextInput");
        const text = textarea.value;
        const charCount = text.length;
        const wordCount =
          text.trim() === "" ? 0 : text.trim().split(/\s+/).length;
        document.getElementById(
          "textStats"
        ).textContent = `${charCount} Zeichen, ${wordCount} Wörter`;
      }

      function loadExampleText() {
        const exampleText =
          "Ich habe gestern ein Buch gelesen. Es war sehr interessant und ich habe viel gelernt. Der Autor schreibt sehr gut und die Geschichte ist spannend.";
        document.getElementById("grammarTextInput").value = exampleText;
        updateTextStats();
      }

      function clearGrammarText() {
        document.getElementById("grammarTextInput").value = "";
        document.getElementById("grammarResults").style.display = "none";
        document.getElementById("copyCorrectedBtn").style.display = "none";
        grammarErrors = [];
        originalText = "";
        updateTextStats();
      }

      async function checkGrammarText() {
        const textarea = document.getElementById("grammarTextInput");
        const text = textarea.value.trim();
        const loadingDiv = document.getElementById("grammarLoading");
        const resultsDiv = document.getElementById("grammarResults");
        const checkBtn = document.getElementById("checkGrammarBtn");

        if (!text) {
          showAlert("Bitte geben Sie einen Text ein!", "warning");
          return;
        }

        const now = Date.now();
        const timeSinceLastRequest = now - lastGrammarCheckTime;

        if (timeSinceLastRequest < GRAMMAR_CHECK_THROTTLE_MS) {
          const remainingSeconds = Math.ceil(
            (GRAMMAR_CHECK_THROTTLE_MS - timeSinceLastRequest) / 1000
          );
          showAlert(
            `Bitte warten Sie ${remainingSeconds} Sekunde${
              remainingSeconds > 1 ? "n" : ""
            } vor der nächsten Prüfung. (Rate Limit: 6 Anfragen pro Minute)`,
            "warning"
          );
          return;
        }

        originalText = text;
        lastGrammarCheckTime = now;
        loadingDiv.style.display = "block";
        resultsDiv.style.display = "none";
        checkBtn.disabled = true;

        try {
          const response = await fetch(
            "https://api.languagetool.org/v2/check",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
              },
              body: `text=${encodeURIComponent(text)}&language=de-DE`,
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          grammarErrors = data.matches || [];

          displayGrammarResults(grammarErrors, text);
        } catch (error) {
          console.error("Grammar check error:", error);
          showAlert(
            "Fehler beim Prüfen des Textes. Bitte versuchen Sie es später erneut.",
            "danger"
          );
        } finally {
          loadingDiv.style.display = "none";
          checkBtn.disabled = false;
        }
      }

      function displayGrammarResults(errors, text) {
        const resultsDiv = document.getElementById("grammarResults");
        const errorCountDiv = document.getElementById("errorCount");
        const errorListDiv = document.getElementById("errorList");

        const errorCount = errors.length;
        errorCountDiv.textContent = `${errorCount} ${
          errorCount === 1 ? "Fehler gefunden" : "Fehler gefunden"
        }`;

        highlightErrors(text, errors);

        displayErrorList(errors);

        resultsDiv.style.display = "block";
        document.getElementById("copyCorrectedBtn").style.display =
          "inline-block";
      }

      function highlightErrors(text, errors) {
        const highlightedDiv = document.getElementById("highlightedText");

        if (errors.length === 0) {
          highlightedDiv.innerHTML = `<p class="text-success mb-0"><i class="fas fa-check-circle"></i> Keine Fehler gefunden! Der Text ist grammatikalisch korrekt.</p>`;
          return;
        }

        const sortedErrors = [...errors].sort((a, b) => b.offset - a.offset);

        let highlightedText = text;

        sortedErrors.forEach((error) => {
          const start = error.offset;
          const end = start + error.length;
          const before = highlightedText.substring(0, start);
          const errorText = highlightedText.substring(start, end);
          const after = highlightedText.substring(end);

          highlightedText = `${before}<mark class="grammar-error" data-error-id="${
            error.offset
          }" data-error-offset="${error.offset}" title="${error.message.replace(
            /"/g,
            "&quot;"
          )} (Klicken für Details)">${errorText}</mark>${after}`;
        });

        const parts = highlightedText.split(/(<mark[^>]*>.*?<\/mark>)/g);
        let escapedText = parts
          .map((part) => {
            if (part.startsWith("<mark")) {
              const tagMatch = part.match(/^(<mark[^>]*>)(.*?)(<\/mark>)$/);
              if (tagMatch) {
                const [, openTag, content, closeTag] = tagMatch;

                return openTag + escapeHtml(content) + closeTag;
              }
              return part;
            }

            return escapeHtml(part);
          })
          .join("");

        highlightedDiv.innerHTML = escapedText.replace(/\n/g, "<br>");

        highlightedDiv.querySelectorAll(".grammar-error").forEach((mark) => {
          mark.style.cursor = "pointer";
          mark.addEventListener("click", function () {
            const errorOffset = parseInt(
              this.getAttribute("data-error-offset")
            );
            scrollToError(errorOffset);
          });
        });
      }

      function scrollToError(errorOffset) {
        const errorItem = document.querySelector(
          `.error-item[data-error-offset="${errorOffset}"]`
        );

        if (errorItem) {
          const resultsDiv = document.getElementById("grammarResults");
          if (resultsDiv && resultsDiv.style.display === "none") {
            resultsDiv.style.display = "block";
          }

          setTimeout(() => {
            errorItem.scrollIntoView({ behavior: "smooth", block: "center" });

            errorItem.style.transition = "background-color 0.3s ease";
            const originalBg =
              errorItem.style.backgroundColor ||
              window.getComputedStyle(errorItem).backgroundColor;
            errorItem.style.backgroundColor = "rgba(59, 130, 246, 0.2)";

            setTimeout(() => {
              errorItem.style.backgroundColor = originalBg || "";
              setTimeout(() => {
                errorItem.style.transition = "";
              }, 300);
            }, 2000);
          }, 50);
        } else {
          console.warn(
            `Error item with offset ${errorOffset} not found. Available offsets:`,
            Array.from(
              document.querySelectorAll(".error-item[data-error-offset]")
            ).map((el) => el.getAttribute("data-error-offset"))
          );
        }
      }

      function displayErrorList(errors) {
        const errorListDiv = document.getElementById("errorList");

        if (errors.length === 0) {
          errorListDiv.innerHTML =
            '<p class="text-success mb-0"><i class="fas fa-check-circle"></i> Keine Fehler gefunden!</p>';
          return;
        }

        errorListDiv.innerHTML = errors
          .map((error, index) => {
            const context = originalText.substring(
              Math.max(0, error.offset - 20),
              Math.min(originalText.length, error.offset + error.length + 20)
            );
            const errorText = originalText.substring(
              error.offset,
              error.offset + error.length
            );
            const suggestions = error.replacements
              .slice(0, 5)
              .map((r) => r.value)
              .filter((v, i, a) => a.indexOf(v) === i);

            return `
              <div class="error-item mb-3 p-3 border-start border-4 border-warning bg-light rounded" data-error-offset="${
                error.offset
              }" id="error-${error.offset}">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div>
                    <strong class="text-danger">
                      <i class="fas fa-exclamation-triangle"></i> Fehler ${
                        index + 1
                      }
                    </strong>
                    <span class="badge bg-secondary ms-2">${
                      error.rule.category.name
                    }</span>
                  </div>
                </div>
                <p class="mb-2"><strong>Meldung:</strong> ${escapeHtml(
                  error.message
                )}</p>
                <p class="mb-2 text-muted small">
                  <strong>Kontext:</strong> ...<span class="notranslate">${escapeHtml(
                    context
                  )}</span>...
                </p>
                <p class="mb-2">
                  <strong>Gefunden:</strong> <code class="text-danger notranslate">${escapeHtml(
                    errorText
                  )}</code>
                </p>
                ${
                  suggestions.length > 0
                    ? `
                  <div class="mb-2">
                    <strong>Vorschläge:</strong>
                    <div class="d-flex flex-wrap gap-2 mt-2 notranslate">
                      ${suggestions
                        .map(
                          (suggestion) => `
                        <button
                          class="btn btn-sm btn-outline-primary suggestion-btn"
                          onclick="applySuggestion(${error.offset}, ${
                            error.length
                          }, '${escapeHtml(suggestion).replace(/'/g, "\\'")}')"
                        >
                          ${escapeHtml(suggestion)}
                        </button>
                      `
                        )
                        .join("")}
                    </div>
                  </div>
                `
                    : ""
                }
              </div>
            `;
          })
          .join("");
      }

      function applySuggestion(offset, length, suggestion) {
        const textarea = document.getElementById("grammarTextInput");
        const text = textarea.value;
        const before = text.substring(0, offset);
        const after = text.substring(offset + length);
        const newText = before + suggestion + after;
        textarea.value = newText;
        updateTextStats();

        const errorIndex = grammarErrors.findIndex(
          (error) => error.offset === offset && error.length === length
        );

        if (errorIndex !== -1) {
          const offsetDiff = suggestion.length - length;

          grammarErrors.splice(errorIndex, 1);

          for (let i = errorIndex; i < grammarErrors.length; i++) {
            grammarErrors[i].offset += offsetDiff;
          }

          originalText = newText;

          displayErrorList(grammarErrors);

          highlightErrors(newText, grammarErrors);

          const errorCountDiv = document.getElementById("errorCount");
          if (errorCountDiv) {
            const errorCount = grammarErrors.length;
            errorCountDiv.textContent = `${errorCount} ${
              errorCount === 1 ? "Fehler gefunden" : "Fehler gefunden"
            }`;
          }

          if (grammarErrors.length === 0) {
            document.getElementById("copyCorrectedBtn").style.display = "none";
          }
        } else {
          originalText = newText;
          const highlightedDiv = document.getElementById("highlightedText");
          if (highlightedDiv) {
            highlightedDiv.innerHTML = escapeHtml(newText).replace(
              /\n/g,
              "<br>"
            );
          }
        }

        showAlert("Vorschlag angewendet!", "success");
      }

      function copyCorrectedText() {
        const textarea = document.getElementById("grammarTextInput");
        const text = textarea.value;

        navigator.clipboard
          .writeText(text)
          .then(() => {
            showAlert("Text in die Zwischenablage kopiert!", "success");
          })
          .catch(() => {
            showAlert("Kopieren fehlgeschlagen", "warning");
          });
      }

      document.addEventListener("DOMContentLoaded", function () {
        const grammarTextarea = document.getElementById("grammarTextInput");
        if (grammarTextarea) {
          grammarTextarea.addEventListener("input", updateTextStats);
          grammarTextarea.addEventListener("keydown", function (e) {
            if (e.ctrlKey && e.key === "Enter") {
              e.preventDefault();
              checkGrammarText();
            }
          });
          updateTextStats();
        }
      });

      function addFormValidation() {
        const verbInput = document.getElementById("verbInput");

        verbInput.addEventListener("input", function () {
          const value = this.value.trim();

          if (!value) {
            this.classList.remove("is-valid", "is-invalid");
            return;
          }

          const isValid = /^[a-zäöüß]+$/.test(value.toLowerCase());

          if (!isValid) {
            this.classList.add("is-invalid");
            this.classList.remove("is-valid");
          } else {
            this.classList.remove("is-invalid");
            this.classList.add("is-valid");
          }
        });
      }

      function addSearchFilter() {
        const searchInput = document.createElement("input");
        searchInput.type = "text";
        searchInput.className = "form-control mb-3";
        searchInput.placeholder = "🔍 Verben filtern...";

        const verbListContainer =
          document.querySelector("#verbList").parentElement;
        verbListContainer.insertBefore(
          searchInput,
          verbListContainer.firstChild
        );

        searchInput.addEventListener("input", function () {
          const searchTerm = this.value.toLowerCase();
          const verbItems = document.querySelectorAll(".verb-item");

          verbItems.forEach((item) => {
            const verbText = item.textContent.toLowerCase();
            const isVisible = verbText.includes(searchTerm);
            item.style.display = isVisible ? "block" : "none";
            item.style.opacity = isVisible ? "1" : "0.5";
          });
        });
      }

      async function batchConjugate(verbs) {
        const results = [];
        const batchSize = 5;

        for (let i = 0; i < verbs.length; i += batchSize) {
          const batch = verbs.slice(i, i + batchSize);
          const batchPromises = batch.map((verb) => processVerb(verb));

          const batchResults = await Promise.allSettled(batchPromises);
          results.push(...batchResults);

          updateProgress(Math.min(i + batchSize, verbs.length), verbs.length);
        }

        return results;
      }

      function handleApiError(error, verb) {
        console.error(`API Error for verb ${verb}:`, error);

        const fallbackVerbs = {
          sein: {
            PRASENS: ["bin", "bist", "ist", "sind", "seid", "sind"],
            PRATERITUM: ["war", "warst", "war", "waren", "wart", "waren"],
            PERFEKT: [
              "bin gewesen",
              "bist gewesen",
              "ist gewesen",
              "sind gewesen",
              "seid gewesen",
              "sind gewesen",
            ],
          },
          haben: {
            PRASENS: ["habe", "hast", "hat", "haben", "habt", "haben"],
            PRATERITUM: [
              "hatte",
              "hattest",
              "hatte",
              "hatten",
              "hattet",
              "hatten",
            ],
            PERFEKT: [
              "habe gehabt",
              "hast gehabt",
              "hat gehabt",
              "haben gehabt",
              "habt gehabt",
              "haben gehabt",
            ],
          },
        };

        if (fallbackVerbs[verb]) {
          return { data: fallbackVerbs[verb] };
        }

        throw error;
      }

      function initializeInteractiveAnimations() {
        const conjugationCards = document.querySelectorAll(
          ".conjugation-mini-card"
        );
        conjugationCards.forEach((card) => {
          card.classList.remove("final-final-touch");
          card.classList.add("subtle-interactive");
        });

        const verbCards = document.querySelectorAll(".mobile-card");
        verbCards.forEach((card) => {
          card.classList.remove("final-final-touch");
          card.classList.add("enhanced-interactive");
        });

        const interactiveElements = [
          ".btn-custom",
          ".verb-item",
          ".form-control",
          ".form-check-input",
          ".card-header",
          ".dark-mode-toggle-final-final-enhanced",
        ];

        interactiveElements.forEach((selector) => {
          const elements = document.querySelectorAll(selector);
          elements.forEach((el) => {
            el.classList.add("enhanced-interactive");
          });
        });
      }

      function enableUltraCompactMode() {
        document.body.classList.add("ultra-compact-mode");

        document.querySelectorAll(".card").forEach((card) => {
          card.style.marginBottom = "8px";
        });

        document.querySelectorAll(".mood-section").forEach((section) => {
          section.style.marginBottom = "6px";
        });

        const grids = document.querySelectorAll(".row.g-3");
        grids.forEach((grid) => {
          grid.classList.remove("g-3");
          grid.classList.add("g-1");
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        addFormValidation();

        addSearchFilter();

        setTimeout(() => {
          const particles = document.querySelectorAll(".particle");
          particles.forEach((particle, index) => {
            particle.style.animationDelay = `${index * 0.2}s`;
          });
        }, 100);

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("animate-fade-in-up");
              }
            });
          },
          { threshold: 0.1 }
        );

        setTimeout(() => {
          const cards = document.querySelectorAll(".card");
          cards.forEach((card) => observer.observe(card));
        }, 500);

        setTimeout(() => {
          initializeInteractiveAnimations();
        }, 100);

        setTimeout(() => {
          enableUltraCompactMode();
        }, 500);
      });

      const style = document.createElement("style");
      style.textContent = `
        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        
        .animate-fade-in-up {
          animation: fadeInUp 0.6s ease-out forwards;
        }
        
        @keyframes slideInDown {
          from {
            transform: translateY(-100%);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
        
        @keyframes slideInDownCentered {
          from {
            transform: translateX(-50%) translateY(-100%);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }
        
        .is-valid {
          border-color: var(--success) !important;
          box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.25) !important;
        }
        
        .is-invalid {
          border-color: var(--error) !important;
          box-shadow: 0 0 0 0.2rem rgba(239, 68, 68, 0.25) !important;
        }
        
        .grammar-error {
          transition: background-color 0.2s ease, box-shadow 0.2s ease;
        }
        
        .grammar-error:hover {
          background-color: rgba(239, 68, 68, 0.3) !important;
          box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
        }
      `;
      document.head.appendChild(style);
    </script>

    <footer class="footer mt-5 py-4 bg-light border-top">
      <div class="container-final-final-enhanced">
        <div class="row align-items-center">
          <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
            <p class="mb-0 text-muted">
              <small>
                <i class="fas fa-info-circle me-1"></i>
                Version <span id="version-info">v1.6</span>
              </small>
            </p>
            <p class="mb-0 text-muted">
              <small>
                <i class="fas fa-code-branch me-1"></i>
                <a
                  href="https://github.com/diviverse/smsk/tree/main/deutsch"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-decoration-none"
                >
                  View on GitHub
                  <i
                    class="fas fa-external-link-alt ms-1"
                    style="font-size: 0.75em"
                  ></i>
                </a>
              </small>
            </p>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>

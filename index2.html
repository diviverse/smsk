<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Gallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <meta name="description" content="My Gallery - gallery.smsk.one" />
    <meta property="og:title" content="My Gallery" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="src/favicon.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      .logo {
        position: fixed;
        top: 0.5rem;
        right: 1.5rem;
        font-size: 3rem;
        font-weight: 500;
        color: rgba(0, 0, 0, 0.6);
        user-select: none;
        pointer-events: none;
        z-index: 9;
      }

      .carousel-control-prev-icon,
      .carousel-control-next-icon {
        width: 2.5rem;
        height: 2.5rem;
        background-size: 60% 60%;
        border-radius: 50%;
        background-color: var(--bs-body-color);
        background-color: color-mix(
          in srgb,
          var(--bs-body-color) 20%,
          transparent
        );
      }

      .carousel-item img {
        object-fit: cover;
        height: 60vh;
      }

      @media (min-width: 768px) {
        .carousel-item img {
          height: 90vh;
        }
      }
    </style>
  </head>
  <body data-bs-theme="light" class="bg-light text-dark">
    <noscript>
      <div class="container text-center py-5">
        JavaScript is required to view this site.
      </div>
    </noscript>

    <div id="loading" class="container text-center py-5">Loading...</div>
    <div class="logo">S</div>

    <main>
      <div id="slider" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators" id="dots"></div>
        <div class="carousel-inner"></div>
        <button
          class="carousel-control-prev"
          type="button"
          data-bs-target="#slider"
          data-bs-slide="prev"
        >
          <span
            class="carousel-control-prev-icon bg-dark bg-opacity-50 rounded-circle"
          ></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button
          class="carousel-control-next"
          type="button"
          data-bs-target="#slider"
          data-bs-slide="next"
        >
          <span
            class="carousel-control-next-icon bg-dark bg-opacity-50 rounded-circle"
          ></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>

      <section id="posts" class="container my-5"></section>

      <nav class="mb-5">
        <ul id="pagination" class="pagination justify-content-center"></ul>
      </nav>
    </main>

    <footer
      class="navbar fixed-bottom justify-content-center bg-body shadow-lg py-2"
    >
      Ege Şimşek &nbsp;
      <a
        target="_blank"
        href="https://instagram.com/smsk.one/"
        class="link-primary link-offset-2 link-opacity-75-hover link-underline-opacity-0 link-underline-opacity-75-hover"
      >
        <i class="bi bi-instagram"></i> smsk.one
      </a>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      async function fetchText(url) {
        try {
          const res = await fetch(url);
          if (!res.ok) throw new Error();
          return await res.text();
        } catch {
          console.error("Oops! Something went wrong.");
          return null;
        }
      }

      const srcRoot = "src";
      (async () => {
        try {
          const jsonURL =
            "https://raw.githubusercontent.com/diviverse/smsk/main/src/.json";
          const posts = await fetch(jsonURL)
            .then((r) => {
              if (!r.ok) throw new Error();
              return r.json();
            })
            .catch(() => []);
          posts.sort((a, b) => new Date(b.date) - new Date(a.date));
          // const visiblePosts = posts.filter((p) => p.vis === 1);
          const visiblePosts = [posts[0], posts[0], posts[0]];
          if (!visiblePosts.length) {
            document.body.innerHTML =
              '<div class="d-flex vh-100 justify-content-center align-items-center"><p class="text-muted">Sorry for the inconvenience.<br>The website is under construction.</p></div>';
          } else {
            buildSlider(visiblePosts.slice(0, 5));
            buildPosts(visiblePosts);
          }
        } finally {
          document.getElementById("loading")?.remove();
        }
      })();

      function buildSlider(images) {
        const inner = document.querySelector("#slider .carousel-inner");
        const dots = document.getElementById("dots");
        inner.innerHTML = "";
        dots.innerHTML = "";

        images.forEach((obj, i) => {
          const item = document.createElement("div");
          item.className = `carousel-item ${i === 0 ? "active" : ""}`;
          item.innerHTML = `<img src="${obj.img}" class="d-block w-100" alt="${
            obj.title || "Post image"
          }">`;
          inner.appendChild(item);

          const btn = document.createElement("button");
          btn.type = "button";
          btn.setAttribute("data-bs-target", "#slider");
          btn.setAttribute("data-bs-slide-to", i);
          btn.className = i === 0 ? "active bg-body" : "bg-body-secondary";
          btn.setAttribute("aria-label", `Slide ${i + 1}`);
          dots.appendChild(btn);
        });
      }

      let currentPage = 1;
      const postsPerPage = 6;
      let totalPages = 1;
      let visiblePosts = [];

      function buildPosts(allPosts) {
        visiblePosts = allPosts;
        totalPages = Math.ceil(visiblePosts.length / postsPerPage);
        showPage(currentPage);
        createPagination();
      }

      function showPage(page) {
        const ctr = document.getElementById("posts");
        ctr.innerHTML = "";
        const start = (page - 1) * postsPerPage;
        const postsToShow = visiblePosts.slice(start, start + postsPerPage);

        postsToShow.forEach((p) => {
          const article = document.createElement("article");
          article.className = "row g-4 mb-5 align-items-start flex-md-row";
          article.innerHTML = `
          <div class="col-md-4">
            <img src="${p.img}" alt="${
            p.title || "Post image"
          }" class="img-fluid rounded">
          </div>
          <div class="col-md-8">
            <h2 class="h4">${p.title}</h2>
            <time class="small d-block mb-2 text-body-secondary">${
              p.date
            }</time>
            <p>${p.body}</p>
          </div>
        `;
          ctr.appendChild(article);
        });
      }

      function createPagination() {
        const container = document.getElementById("pagination");
        container.innerHTML = "";
        for (let i = 1; i <= totalPages; i++) {
          const li = document.createElement("li");
          li.className = `page-item ${i === currentPage ? "active" : ""}`;
          const a = document.createElement("a");
          a.className = "page-link bg-body text-body";
          a.href = "#";
          a.textContent = i;
          a.addEventListener("click", (e) => {
            e.preventDefault();
            currentPage = i;
            showPage(currentPage);
            createPagination();
            window.scrollTo({ top: 0, behavior: "smooth" });
          });
          li.appendChild(a);
          container.appendChild(li);
        }
      }
    </script>
    <script>
      if (
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches
      ) {
        document.body.setAttribute("data-bs-theme", "dark");
        document.body.classList.remove("bg-light", "text-dark");
        document.body.classList.add("bg-dark", "text-light");
      }

      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", (e) => {
          if (e.matches) {
            document.body.setAttribute("data-bs-theme", "dark");
            document.body.classList.remove("bg-light", "text-dark");
            document.body.classList.add("bg-dark", "text-light");
          } else {
            document.body.setAttribute("data-bs-theme", "light");
            document.body.classList.remove("bg-dark", "text-light");
            document.body.classList.add("bg-light", "text-dark");
          }
        });
    </script>
  </body>
</html>
